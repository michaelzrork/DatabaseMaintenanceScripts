/*------------------------------------------------------------------------
    File        : fixSADetailStatus.p
    Purpose     : 

    Syntax      : 

    Description : Fix stuck tee time pattern reservations

    Author(s)   : michaelzrork
    Created     : 
    Notes       : 
  ----------------------------------------------------------------------*/

/*************************************************************************
                                DEFINITIONS
*************************************************************************/

define variable recNum as integer   no-undo.
define variable idList as character no-undo.
define variable ix     as integer   no-undo.

assign
    recNum = 0
    ix     = 0
    idList = "17014028,17014031,17014164,17014167,17014205,17014207,17014222,17014225,17014301,17014302,17014404,17014406,17014445,17014447,17014539,17014540,17014623,17014677,17014679,17014716,17014719,17014763,17014793,17014794,17014814,17014817,17014845,
              17014847,17015098,17015099,17015165,17015168,17015210,17015211,17015284,17015286,17015443,17015445,17015469,17015471,17015674,17015677,17015701,17015703,17015731,17015733,17015748,17015751,17015793,17015829,17015831,17015865,17015867,17015892,
              17015894,17016026,17016027,17016084,17016086,17016198,17016201,17016283,17016285,17016361,17016362,17016363,17016378,17016387,17016391,17016449,17016452,17016454,17016458,17016475,17016478,17016616,17016626,17016763,17016768,17016793,17016796,
              17016799,17016802,17016804,17016808,17016825,17016830,17016856,17016858,17016896,17016900,17016932,17016933,17016934,17016940,17016941,17016956,17016960,17017004,17017015,17017018,17017019,17017020,17017023,17017024,17017053,17017056,17017144,
              17017146,17017178,17017180,17017204,17017207,17017232,17017234,17017388,17017390,17017420,17017480,17017484,17017560,17017563,17017694,17017695,17017771,17017775,17017823,17017826,17017932,17017967,17017971,17018023,17018028,17018078,17018232,
              17018235,17018241,17018243,17018317,17018320,17018412,17018418,17018465,17018640,17018643,17018677,17018684,17018691,17018711,17018716,17018719,17018726,17018727,17018729,17019951,17019954,17021348,17021351,17021355,17021359,17021576,17021577,
              17021607,17021609,17021613,17021617,17021641,17021647,17021650,17021664,17021667,17021676,17021687,17021689,17021690,17022552,17022554,17022592,17022595,17022604,17022676,17022678,17022682,17022686,17022828,17022834,17022837,17023531,17023533,
              17024632,17024636,17611472,17611475,17611487,17611489,17611491,17611493,17611516,17611519,17611520,17611523,17612013,17612015,17612016,20210778,21372018,21372065,21372100,21372143,21372195,21372196,21372206,21372239,21372244,21372279,21372307,
              21372313,21372325,21372353,21372388,21372398,21372474,21372488,21372526,21372545,21372551,21372587,21372600,21372606,21372700,21372720,21372777,21372824,21372837,21372846,21372907,21372924,21372977,21373006,21373042,21373079,21373123,21373170,
              21373181,21373197,21373208,21373210,21373221,21373230,21373241,21373246,21373255,21373257,21373303,21373314,21373346,21373360,21373384,21373413,21373450,21373470,21373474,21373499,21373509,21373510,21373513,21373517,21373548,21373557,21373574,
              21373606,21373609,21373673,21373687,21373692,21373694,21373703,21373723,21373730,21373733,21373734,21373738,21373758,21373781,21373783,21373811,21373814,21373817,21373820,21373866,21373902,21373912,21373936,21373952,21373956,21373968,21373972,
              21373982,21374016,21374028,21374057,21374062,21374070,21374080,21374101,21374117,21374120,21374132,21374144,21374149,21374159,21374181,21374208,21374222,21374242,21374244,21374255,21374277,21374289,21374292,21374304,21374309,21374315,21374316,
              21374390,21374415,21374419,21374432,21374446,21374450,21374452,21374476,21374500,21374514,21374516,21374522,21374547,21374578,21374584,21374587,21374616,21374628,21374647,21374651,21374672,21374734,21374736,21374757,21374764,21374779,21374823,
              21374858,21374878,21374925,21374947,21374948,21374958,21374962,21374971,21374994,21375010,21375028,21375032,21375044,21375102,21375122,21375169,21375188,21375198,21375215,21375218,21376001,21376031,21376045,21376047,21376121,21376166,21376174,
              21376177,21376253,21376324,21376342,21376406,21376427,21376503,21376511,21376574,21376577,21376587,21376699,21376740,21376805,21376826,21376828,21376851,21376877,21376896,21376898,21376899,21376902,21376926,21377042,21377058,21377063,21377081,
              21377083,21377088,21377091,21377092,21377183,21377258,21377267,21377314,21377357,21377359,21377376,21377378,21377379,21377403,21377457,21377469,21377485,21377521,21377571,21377622,21377635,21377687,21377756,21377799,21377865,21377867,21377934,
              21377950,21377951,21378022,21378034,21378050,21378053,21378065,21378105,21378150,21378152,21378160,21378178,21378217,21378272,21378274,21378276,21378307,21378308,21378327,21378340,21378343,21378426,21378428,21378445,21378449,21378461,21378485,
              21378491,21378638,21378639,21378687,21378692,21378725,21378794,21378798,21378804,21378830,21378833,21378940,21378968,21378971,21378976,21379052,21379110,21379119,21379199,21379212,21379281,21379345,21379349,21379379,21379445,21379447,21379458,
              21379527,21379604,21379659,21379696,21379699,21379716,21379840,21379960,21380020,21380022,21380026,21380056,21380059,21380099,21380121,21380144,21380251,21380371,21380499,21380565,21380622,21380720,21380750,21380793,21380807,21380933,21380954,
              21380966,21380967,21380990,21381058,21381109,21381297,21381403,21381476,21381558,21381596,21381720,21381722,21381753,21381754,21381774,21381791,21381796,21381984,21382013,21382062,21382066,21382085,21382122,21382305,21382382,21382386,21382387,
              21382519,21382521,21382524,21382528,21382579,21382787,21382789,21382797,21382801,21382832,21383028,21383187,21383189,21383210,21383246,21383390,21383627,21383687,21383688,21383706,21383710,21383712,21383751,21383876,21384005,21384030,21384065,
              21384127,21384180,21384328,21384330,21384429,21384716,21384720,21384825,21384827,21384850,21384872,21518111,21518146,21518224,21518259,21518265,21518289,21518292,21518297,21518315,21518318,21518323,21518334,21518339,21518342,21518347,21518354,
              21518400,21518447,21518480,21518491,21518496,21518504,21518508,21518514,21518519,21538373".

/*************************************************************************
                                MAIN BLOCK
*************************************************************************/

do ix = 1 to num-entries(idList):
    run fixStatus(int64(entry(ix,idList))).
end.

run ActivityLog.

/*************************************************************************
                            INTERNAL PROCEDURES
*************************************************************************/

// FIX TRANSACTIONDETAIL STATUS
procedure fixStatus:
    define input parameter inpID as int64 no-undo.
    define buffer bufTransactionDetail for TransactionDetail.
    do for bufTransactionDetail transaction:
        find first bufTransactionDetail exclusive-lock where bufTransactionDetail.ID = inpid no-wait no-error.
        if available bufTransactionDetail then assign
                recNum                   = recNum + 1
                bufTransactionDetail.RecordStatus = "Cancelled"
                bufTransactionDetail.CartStatus   = "Complete".
    end.
end procedure.

// CREATE AUDIT LOG ENTRY DISPLAYING HOW MANY RECORDS WERE CHANGED
procedure ActivityLog:
    def buffer bufActivityLog for ActivityLog.
    do for bufActivityLog transaction:
        create bufActivityLog.
        assign
            bufActivityLog.SourceProgram = "fixSADetailStatus.p"
            bufActivityLog.LogDate       = today
            bufActivityLog.LogTime       = time
            bufActivityLog.UserName      = "SYSTEM"
            bufActivityLog.Detail1       = "Fix stuck tee time pattern reservations"
            bufActivityLog.Detail2       = "Number of Records Adjusted: " + string(recNum).
    end.
end procedure.